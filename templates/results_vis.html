$def with (matkat, params, t, dt)

DEBUG
<strong>$t s</strong>
$for k, v in params.iteritems():
  $k=<strong>$v</strong>
dt=<strong>$dt</strong>

<div class="container-fluid">
<div class="row-fluid">

<!-- Hakulomake sivupalkissa -->
<div class="span3">
<div class="well sidebar-nav sidebar-nav-fixed">
  <h3>Hae yhteyksiä</h3>
  <div class="breaker"></div>
  <br>
  <form class="form-horizontal" method="GET" action="Joukkoliikenteen hintavertailu - tulokset.htm" id="lomake">
    <label>Mistä</label>
    <input class="input" id="inputMista" type="text" name="mista" autocomplete="off" required autofocus/>
    <label>Minne</label>
    <input id="inputMihin" type="text" name="mihin" autocomplete="off" required/>
    <div class="breaker"></div>
    <br>
    <label>Aika ja Pvm</label>
    <input type="text" class="input-xmini" id="inputTunnit" name="h" pattern="([01]?[0-9]|2[0-3])">
    <small>:</small>
    <input type="text" class="input-xmini" id="inputMinuutit" name="min" pattern="[0-5]?[0-9]">
    <input type="text" class="input-small" id="inputPvm" name="pvm" pattern="([0-2]?[0-9]|3[0-1])\.([1-9]|0[1-9]|1[0-2])\.(20)?1[3-9]">
    <br>
    <div id="datepicker"></div>
    <select id="inputAikatyyppi" class="input-medium" name="tyyppi">
      <option value="saapumisaika">Saapumisaika</option>
      <option value="lahtoaika">Lähtöaika</option>
    </select>
    <div class="breaker"></div>
    <br>
    <label>Alennusluokka</label>
    <select class="input-medium" name="ale">
      <option value="0">Aikuinen</option>
      <option value="1">Lapsi(4-11 v)</option>
      <option value="3">Nuori(12-16 v)</option>
      <option value="2">Opiskelija</option>
      <option value="5">Varusmies</option>
      <option value="7">Siviilipalvelusmies</option>
      <option value="4">Eläkeläinen</option>
      <option value="6">Lehdistö</option>
    </select>
    <label>Auton keskikulutus</label>
    <select id="inputKeskikulutus" class="input-large" name="kulutus">
      <option value="0">95E, Pieni (4,5l/100km)</option>
      <option value="1">95E, Keski(6,5l/100km)</option>
      <option value="2">95E, Suuri (8,5l/100km)</option>
      <option class="select-dash" disabled>----</option>
      <option value="3">98E, Pieni (4,5l/100km)</option>
      <option value="4">98E, Keski (6,5l/100km)</option>
      <option value="5">98E, Suuri (8,5l/100km)</option>
      <option class="select-dash" disabled>----</option>
      <option value="6">Di, Pieni (3,7l/100km)</option>
      <option value="7">Di, Keski (5,7l/100km)</option>
      <option value="8">Di, Suuri (7,7l/100km)</option>
    </select>
    <br>

    <label class="checkbox inline">
      <input type="checkbox" name="juna" checked=""> Juna
    </label>
    <label class="checkbox inline">
      <input type="checkbox" name="bussi" checked=""> Bussi
    </label>
    <label class="checkbox inline">
      <input type="checkbox" name="auto" checked=""> Auto
    </label>
    <br>
    <button class="btn btn-primary" type="submit">Hae yhteyksiä<i class="icon-search icon-white"></i></button>
  </form>
</div> <!-- /.sidebar-nav-fixed -->
</div> <!-- /.span3 -->


<!-- Hakutulokset -->
<div class="span9">
<div class="results-header">
  <div class="btn-group">
    <button class="btn btn-primary" onclick="sortByDt1()">Lähtö</button>
    <button class="btn btn-primary" onclick="sortByDt2()">Saapuminen</button>
    <button class="btn btn-primary" onclick="sortByDuration()">Kesto</button>
    <button class="btn btn-primary" onclick="sortByPrice()">Hinta</button>
    <button class="btn btn-primary" onclick="sortByTransfers()">Vaihdot</button>
  </div>
</div>

<div class="results"></div>
</div> <!-- /.span* -->
</div> <!-- /.container -->
</div> <!-- /.row -->

<script>
window.onload = function() {

// Datepicker:
var dpSettings = {
    altField: "#inputPvm",
    minDate: 0,
    altFormat: "d.m.yy",
    dayNamesMin: ["Ma","Ti","Ke","To","Pe","La","Su"],
    monthNames: ["Tammi","Helmi","Maalis","Huhti","Touko","Kesä", "Heinä","Elo","Syys","Loka","Marras","Joulu"]
};
$( "#datepicker" ).datepicker(dpSettings);

// Visualisaatio:
var query_date = "$dt";
var data = [

$if "auto" in matkat and not "virhe" in matkat["auto"]:
    $ m = matkat["auto"]
    {"luokka":"auto","lahtoaika":"$m["js_aika"]","tunnit":$m["tunnit"],"kesto":"$m["kesto"]","hinta":$m["hinta"],"vaihdot_lkm":0,"tyyppi":"Auto"},

$code:
    mh_ja_vr = []
    for x in ["juna", "bussi"]:
        if x in matkat and not "virhe" in matkat[x]:
            mh_ja_vr += matkat[x]

$for m in mh_ja_vr:
    {"luokka":"$m["luokka"]","lahtoaika":"$m["js_aika"]","tunnit":$m["tunnit"],"kesto":"$m["kesto"]","hinta":$m["hinta"],"vaihdot_lkm":$m["vaihdot_lkm"],"tyyppi":"$m["tyyppi"]"},

]
}
</script>
<script src="/static/js/d3.v3.min.js"></script>
<script src="/static/js/d3testi.js"></script>
